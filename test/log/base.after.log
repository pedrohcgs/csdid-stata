
  ___  ____  ____  ____  ____ ®
 /__    /   ____/   /   ____/      Stata 18.0
___/   /   /___/   /   /___/       MP—Parallel Edition

 Statistics and Data Science       Copyright 1985-2023 StataCorp LLC
                                   StataCorp
                                   4905 Lakeway Drive
                                   College Station, Texas 77845 USA
                                   800-782-8272        https://www.stata.com
                                   979-696-4600        service@stata.com

Stata license: 5-user 12-core network perpetual
Serial number: 501806356410
  Licensed to: Population Studies and Training Center
               Brown University

Notes:
      1. Stata is running in batch mode.
      2. Unicode is supported; see help unicode_advice.
      3. More than 2 billion observations are allowed; see help obs_advice.
      4. Maximum number of variables is set to 5,000 but can be increased;
          see help set_maxvar.


Running /home/mauricio/ado/personal/sysprofile.do ...


Running /home/mauricio/ado/profile.do ...

. do test/base.do 

. * ssc install flexdid
. 
. local root `c(pwd)'

. cd codes
/home/mauricio/Documents/projects/ra/santanna/csdid-stata/codes

. do `root'/test/common.do

. cap mata mata drop _loadmat()

. mata:
------------------------------------------------- mata (type end to exit) -----
: real matrix function _loadmat(string scalar fname) {
>     real vector mat
>     real scalar fh, nr, nc
>     colvector C
>     fh  = fopen(fname, "r")
>     C   = bufio()
>     nr  = fbufget(C, fh, "%4bu", 1)
>     nc  = fbufget(C, fh, "%4bu", 1)
>     mat = fbufget(C, fh, "%8z", nr * nc)
>     fclose(fh)
>     return(rowshape(mat, nc)')
> }

: end
-------------------------------------------------------------------------------

. 
end of do-file

. 
. local methods drimp dripw reg stdipw ipw rc1

. local aggtyps simple group calendar dynamic

. use `root'/tmp/base.dta, clear

. 
.     foreach m of local methods {
  2.         tempfile `m'
  3.     }

.     foreach m of local methods {
  2.         disp "`m'"
  3.         qui csdid Y X, gvar(G) time(period) method(`m') id(id)
  4.         qui estimates save "``m''.ster", replace
  5.     }
drimp
dripw
reg
stdipw
ipw
rc1
Method rc1 not allowed

. 
.     foreach m of local methods {
  2.         mata: `m' = _loadmat("`root'/tmp/tmpbase_`m'")
  3.         foreach typ of local aggtyps {
  4.             mata: `m'`typ' = _loadmat("`root'/tmp/tmpbase_`m'_`typ'")
  5.         }
  6.     }

. 
.     foreach m of local methods {
  2.         estimates use "``m''.ster"
  3.         qui csdid
  4.         mata out    = st_matrix("r(table)")[1::2,1..rows(`m')]'
  5.         mata errors = colmax(abs(reldif(`m', out)))
  6.         mata printf("\n%17s: %9.6g\t%9.6g\n", "`m'", errors[1], errors[2])
  7.         foreach typ of local aggtyps {
  8.             if "`typ'" == "dynamic" {
  9.                 qui csdid_estat event
 10.                 mata row = st_matrix("r(table)")[1::2,.]'
 11.                 mata row = row[2::rows(row),.]
 12.             }
 13.             else {
 14.                 qui csdid_estat `typ'
 15.                 mata row = st_matrix("r(table)")[1::2,.]'
 16.             }
 17.             mata errors = colmax(abs(reldif(`m'`typ', row)))
 18.             mata printf("%17s: %9.6g\t%9.6g\n", "`typ' `m'", errors[1], er
> rors[2])
 19.         }
 20.     }

            drimp:  .0000205     .0000559
     simple drimp:  2.23e-06     6.22e-06
      group drimp:  8.46e-06     .0000339
   calendar drimp:  3.50e-06     .0000167
    dynamic drimp:  .0000126     .0000559

            dripw:  9.68e-16     1.50e-11
     simple dripw:         0     6.48e-12
      group dripw:  3.49e-16     2.34e-08
   calendar dripw:  1.15e-16     1.48e-11
    dynamic dripw:  5.43e-16     1.50e-11

              reg:  3.32e-15     1.46e-16
       simple reg:  5.61e-17            0
        group reg:  2.85e-15     1.57e-08
     calendar reg:  2.29e-15     1.25e-17
      dynamic reg:  2.68e-15     2.50e-17

           stdipw:  .0044097      .116297
    simple stdipw:  .0004803     .0444609
     group stdipw:   .002472      .116297
  calendar stdipw:  .0012419     .0776941
   dynamic stdipw:  .0044097     .0726368

              ipw:   .000391      .119255
       simple ipw:  .0000184     .0559202
        group ipw:  .0002212      .119255
     calendar ipw:  .0000628     .0855367
      dynamic ipw:   .000391      .090893

              rc1:  .0000205     .0001211
       simple rc1:  2.23e-06     .0000197
        group rc1:  8.46e-06     .0001014
     calendar rc1:  3.50e-06     .0000361
      dynamic rc1:  .0000126     .0001211

. 
end of do-file
